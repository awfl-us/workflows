main:
  params:
  - "input"
  steps:
  - run_agent_workflow:
      try:
        steps:
        - run_agent_workflow_call:
            call: "googleapis.workflowexecutions.v1.projects.locations.workflows.executions.run"
            args:
              workflow_id: "${(string(input.tool_call.function.name) + \"${WORKFLOW_ENV}\")}"
              argument:
                query: "${map.get(json.decode(input.tool_call.function.arguments), \"query\")}"
                fund: "${default(map.get(json.decode(input.tool_call.function.arguments), \"fund\"), 0)}"
                task: "${default(map.get(json.decode(input.tool_call.function.arguments), \"task\"), null)}"
                env:
                  userId: "${input.env.userId}"
                  model: "${input.env.model}"
                  callingWorkflowExec: "${default(map.get(input.env, \"callingWorkflowExec\"), null)}"
                  BASE_URL: "${input.env.BASE_URL}"
                  background: "${default(map.get(input.env, \"background\"), null)}"
                  projectId: "${input.env.projectId}"
                  sessionId: "${string(input.tool_call.function.name)}"
              location: "${sys.get_env(\"GOOGLE_CLOUD_LOCATION\")}"
              project_id: "${sys.get_env(\"GOOGLE_CLOUD_PROJECT_ID\")}"
              connector_params:
                skip_polling: false
            result: "run_agent_workflowResult_59f34f57"
      retry: "${http.default_retry}"
  - return:
      return:
        encoded: "${json.encode_to_string(run_agent_workflowResult_59f34f57)}"
        cost: "${run_agent_workflowResult_59f34f57.total_cost}"
