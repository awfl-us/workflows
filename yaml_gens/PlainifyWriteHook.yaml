main:
  params:
  - "input"
  steps:
  - read_raw_params:
      steps:
      - read_raw_params_initResult:
          assign:
          - read_raw_paramsResult_6a55d07: {}
      - read_raw_params_steps:
          try:
            steps:
            - read_raw_params_updateResult:
                assign:
                - read_raw_paramsResult_6a55d07:
                    filepath: "${input.filepath}"
          except:
            as: "read_raw_paramsError"
            steps:
            - read_raw_params_logError:
                try:
                  steps:
                  - read_raw_params_logError_call:
                      call: "sys.log"
                      args:
                        text: "${(\"[read_raw_params_logError] \" + read_raw_paramsError.message)}"
                      result: "read_raw_params_logErrorResult_fea46e6"
                retry: "${http.default_retry}"
            - read_raw_params_updateResultError:
                assign:
                - read_raw_paramsResult_6a55d07: "${null}"
  - readRaw_callback_block:
      steps:
      - readRaw_run_tools_CliTools:
          try:
            steps:
            - readRaw_run_tools_CliTools_call:
                call: "googleapis.workflowexecutions.v1.projects.locations.workflows.executions.run"
                args:
                  workflow_id: "${\"tools-CliTools${WORKFLOW_ENV}\"}"
                  argument:
                    tool_call:
                      id: "${\"read_raw\"}"
                      type: "function"
                      function:
                        name: "${\"READ_FILE\"}"
                        arguments: "${json.encode_to_string(read_raw_paramsResult_6a55d07)}"
                    cost: 0.0
                    env:
                      userId: "${input.env.userId}"
                      model: "${input.env.model}"
                      callingWorkflowExec: "${default(map.get(input.env, \"callingWorkflowExec\"), null)}"
                      BASE_URL: "${input.env.BASE_URL}"
                      background: "${default(true, null)}"
                      projectId: "${input.env.projectId}"
                      sessionId: "${input.env.sessionId}"
                  location: "${sys.get_env(\"GOOGLE_CLOUD_LOCATION\")}"
                  project_id: "${sys.get_env(\"GOOGLE_CLOUD_PROJECT_ID\")}"
                  connector_params:
                    skip_polling: false
                result: "readRaw_run_tools_CliToolsResult_1edc0607"
          retry: "${http.default_retry}"
  - plainifyMessages:
      steps:
      - plainifyMessages_initResult:
          assign:
          - plainifyMessagesResult_3c148287: []
      - plainifyMessages_steps:
          for:
            value: "plainifyMessagesIdx"
            range: "${[0, (2 - 1)]}"
            steps:
            - plainifyMessages_switch:
                steps:
                - plainifyMessages_switch_initResult:
                    assign:
                    - plainifyMessages_switchResult_5ddb566f: {}
                - plainifyMessages_switch_steps:
                    switch:
                    - condition: "${(plainifyMessagesIdx == 0)}"
                      steps:
                      - plainifyMessages_switch_updateResult_0:
                          assign:
                          - plainifyMessages_switchResult_5ddb566f:
                              role: "system"
                              content: "${(\"Translate the following code completely into precise, plain technical English. Include all types, methods, data flow, control flow, external interactions, and intent. No omissions. Include the full class signature in code, but the implementation and logic should be in plain English.\n\nTarget filepath: \" + input.filepath)}"
                              tool_calls: "${[]}"
                              tool_call_id: "${null}"
                              create_time: "${sys.now()}"
                              docId: "${null}"
                    - condition: "${(plainifyMessagesIdx == 1)}"
                      steps:
                      - plainifyMessages_switch_updateResult_1:
                          assign:
                          - plainifyMessages_switchResult_5ddb566f:
                              role: "user"
                              content: "${(\"Code follows:\n\n\" + map.get(json.decode(readRaw_run_tools_CliToolsResult_1edc0607.encoded), \"content\"))}"
                              tool_calls: "${[]}"
                              tool_call_id: "${null}"
                              create_time: "${sys.now()}"
                              docId: "${null}"
            - plainifyMessages_updateResult:
                assign:
                - plainifyMessagesResult_3c148287: "${list.concat(plainifyMessagesResult_3c148287, plainifyMessages_switchResult_5ddb566f)}"
  - plainify:
      try:
        steps:
        - plainify_call:
            call: "http.post"
            args:
              url: "${((input.env.BASE_URL + \"/\") + \"llm/chat\")}"
              body:
                messages: "${plainifyMessagesResult_3c148287}"
                model: "${\"gpt-5\"}"
                temperature: 0.8
                max_completion_tokens: "${null}"
                response_format:
                  type: "text"
                tools: "${null}"
                tool_choice: "${if(((null != null) and (len(null) > 0)), \"none\", null)}"
              auth:
                type: "OIDC"
                audience: "${input.env.BASE_URL}"
              headers:
                x-user-id: "${input.env.userId}"
                x-project-id: "${input.env.projectId}"
            result: "plainifyResult_6b2715d9"
      retry: "${http.default_retry}"
  - mkdir_plain_params:
      steps:
      - mkdir_plain_params_initResult:
          assign:
          - mkdir_plain_paramsResult_31de73c6: {}
      - mkdir_plain_params_steps:
          try:
            steps:
            - mkdir_plain_params_updateResult:
                assign:
                - mkdir_plain_paramsResult_31de73c6:
                    command: "${((\"bash -lc 'mkdir -p $(dirname \" + (\"plain/\" + input.filepath)) + \")'\")}"
          except:
            as: "mkdir_plain_paramsError"
            steps:
            - mkdir_plain_params_logError:
                try:
                  steps:
                  - mkdir_plain_params_logError_call:
                      call: "sys.log"
                      args:
                        text: "${(\"[mkdir_plain_params_logError] \" + mkdir_plain_paramsError.message)}"
                      result: "mkdir_plain_params_logErrorResult_7c33143a"
                retry: "${http.default_retry}"
            - mkdir_plain_params_updateResultError:
                assign:
                - mkdir_plain_paramsResult_31de73c6: "${null}"
  - mkdirPlain_callback_block:
      steps:
      - mkdirPlain_run_tools_CliTools:
          try:
            steps:
            - mkdirPlain_run_tools_CliTools_call:
                call: "googleapis.workflowexecutions.v1.projects.locations.workflows.executions.run"
                args:
                  workflow_id: "${\"tools-CliTools${WORKFLOW_ENV}\"}"
                  argument:
                    tool_call:
                      id: "${\"mkdir_plain\"}"
                      type: "function"
                      function:
                        name: "${\"RUN_COMMAND\"}"
                        arguments: "${json.encode_to_string(mkdir_plain_paramsResult_31de73c6)}"
                    cost: 0.0
                    env:
                      userId: "${input.env.userId}"
                      model: "${input.env.model}"
                      callingWorkflowExec: "${default(map.get(input.env, \"callingWorkflowExec\"), null)}"
                      BASE_URL: "${input.env.BASE_URL}"
                      background: "${default(true, null)}"
                      projectId: "${input.env.projectId}"
                      sessionId: "${\"plaintify_write_hook\"}"
                  location: "${sys.get_env(\"GOOGLE_CLOUD_LOCATION\")}"
                  project_id: "${sys.get_env(\"GOOGLE_CLOUD_PROJECT_ID\")}"
                  connector_params:
                    skip_polling: false
                result: "mkdirPlain_run_tools_CliToolsResult_6cd39738"
          retry: "${http.default_retry}"
  - write_plain_params:
      steps:
      - write_plain_params_initResult:
          assign:
          - write_plain_paramsResult_4bfe8b43: {}
      - write_plain_params_steps:
          try:
            steps:
            - write_plain_params_updateResult:
                assign:
                - write_plain_paramsResult_4bfe8b43:
                    filepath: "${(\"plain/\" + input.filepath)}"
                    content: "${plainifyResult_6b2715d9.body.message.content}"
          except:
            as: "write_plain_paramsError"
            steps:
            - write_plain_params_logError:
                try:
                  steps:
                  - write_plain_params_logError_call:
                      call: "sys.log"
                      args:
                        text: "${(\"[write_plain_params_logError] \" + write_plain_paramsError.message)}"
                      result: "write_plain_params_logErrorResult_7d80f2c2"
                retry: "${http.default_retry}"
            - write_plain_params_updateResultError:
                assign:
                - write_plain_paramsResult_4bfe8b43: "${null}"
  - writePlain_callback_block:
      steps:
      - writePlain_run_tools_CliTools:
          try:
            steps:
            - writePlain_run_tools_CliTools_call:
                call: "googleapis.workflowexecutions.v1.projects.locations.workflows.executions.run"
                args:
                  workflow_id: "${\"tools-CliTools${WORKFLOW_ENV}\"}"
                  argument:
                    tool_call:
                      id: "${\"write_plain\"}"
                      type: "function"
                      function:
                        name: "${\"UPDATE_FILE\"}"
                        arguments: "${json.encode_to_string(write_plain_paramsResult_4bfe8b43)}"
                    cost: 0.0
                    env:
                      userId: "${input.env.userId}"
                      model: "${input.env.model}"
                      callingWorkflowExec: "${default(map.get(input.env, \"callingWorkflowExec\"), null)}"
                      BASE_URL: "${input.env.BASE_URL}"
                      background: "${default(true, null)}"
                      projectId: "${input.env.projectId}"
                      sessionId: "${\"plaintify_write_hook\"}"
                  location: "${sys.get_env(\"GOOGLE_CLOUD_LOCATION\")}"
                  project_id: "${sys.get_env(\"GOOGLE_CLOUD_PROJECT_ID\")}"
                  connector_params:
                    skip_polling: false
                result: "writePlain_run_tools_CliToolsResult_2cdb7ad3"
          retry: "${http.default_retry}"
  - return:
      return: "${(\"plain/\" + input.filepath)}"
